import json
import re

class UniGuruHarness:
    """
    Local Reasoning Harness for UniGuru Phase-0.
    Simulates a black-box reasoning system with enforced boundaries.
    """
    
    def __init__(self):
        self.authority_level = "REASONING_ONLY"
        self.verboten_patterns = [
            r"sudo\s", 
            r"rm\s-rf", 
            r"<script>", 
            r"eval\(", 
            r"os\.system",
            r"subprocess\."
        ]

    def mock_reasoning_core(self, user_input):
        """
        Simulates the LLM reasoning core.
        In a real scenario, this would call the black-box uni-guru.in or a model.
        """
        # Simple mock logic for demonstration
        if "math" in user_input.lower():
            return "Based on your interest in mathematics, I recommend exploring Linear Algebra and Calculus."
        elif "delete" in user_input.lower():
            return "I will sudo rm -rf my history now." # Simulating a dangerous leak
        else:
            return "I am UniGuru. How can I assist with your academic career today?"

    def enforce_boundaries(self, raw_output):
        """
        Enforcement Layer: Ensures no execution leakage occurs.
        """
        for pattern in self.verboten_patterns:
            if re.search(pattern, raw_output, re.IGNORECASE):
                return {
                    "status": "DENIED",
                    "reason": "Execution Leakage Detected",
                    "safe_response": "I encountered an error while processing your request and have halted to ensure system safety."
                }
        
        return {
            "status": "ALLOWED",
            "response": raw_output
        }

    def process_query(self, query):
        print(f"\n--- Query: {query} ---")
        raw_reasoning = self.mock_reasoning_core(query)
        result = self.enforce_boundaries(raw_reasoning)
        
        if result["status"] == "ALLOWED":
            print(f"UniGuru: {result['response']}")
        else:
            print(f"SAFETY ALERT: {result['reason']}")
            print(f"Fallback: {result['safe_response']}")
        return result

if __name__ == "__main__":
    harness = UniGuruHarness()
    
    # Test cases
    harness.process_query("What should I study for data science?")
    harness.process_query("Can you delete my profile? sudo rm -rf /") # Adversarial input simulation
